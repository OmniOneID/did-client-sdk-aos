package org.omnione.did.sdk.core.api;

import android.content.Context;

import androidx.test.ext.junit.runners.AndroidJUnit4;
import androidx.test.platform.app.InstrumentationRegistry;

import org.junit.Before;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.omnione.did.sdk.core.zkp.datamodel.ZKPInfo;
import org.omnione.did.sdk.datamodel.util.GsonWrapper;
import org.omnione.did.sdk.datamodel.zkp.AvailableReferent;
import org.omnione.did.sdk.datamodel.zkp.Credential;
import org.omnione.did.sdk.datamodel.zkp.CredentialDefinition;
import org.omnione.did.sdk.datamodel.zkp.CredentialOffer;
import org.omnione.did.sdk.datamodel.zkp.CredentialSchema;
import org.omnione.did.sdk.datamodel.zkp.Proof;
import org.omnione.did.sdk.datamodel.zkp.ProofRequest;
import org.omnione.did.sdk.datamodel.zkp.UserReferent;
import org.omnione.did.sdk.datamodel.zkp.CredentialRequestContainer;
import org.omnione.did.sdk.wallet.walletservice.config.Constants;
import org.omnione.did.sdk.wallet.walletservice.logger.WalletLogger;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

/**
 * Instrumented test, which will execute on an Android device.
 *
 * @see <a href="http://d.android.com/tools/testing">Testing documentation</a>
 */
@RunWith(AndroidJUnit4.class)
public class ZKPManagerTest {
    private ZKPManager<ZKPInfo> zkpManager;
    private Context appContext;

    private CredentialDefinition credentiaDefinition;
    private CredentialSchema credentialSchema;

    private CredentialOffer credentialOffer;

    private CredentialRequestContainer requestCredentialBuilder;
    private Credential credential;

    private ProofRequest proofRequest;

    private Proof proof;

    @Before
    public void setUp() throws Exception {

        String credentialSchemaDummyStr = """
                {
                    "id": "did:omn:NcYxiDXkpYi6ov5FcYDi1e:2:mdl:1.0",
                    "name": "mdl",
                    "version": "1.0",
                    "attrNames": [
                      "zkpsex",
                      "zkpbirth",
                      "zkpasort",
                      "zkpaddr"
                    ],
                    "tag": "Tag1"
                 }
                """;

        String credentialDefinitionDummyStr = """
                {
                   "id": "did:omn:NcYxiDXkpYi6ov5FcYDi1e:3:CL:did:omn:NcYxiDXkpYi6ov5FcYDi1e:2:mdl:1.0:Tag1",
                   "schemaId": "did:omn:NcYxiDXkpYi6ov5FcYDi1e:2:mdl:1.0",
                   "ver": "1.0",
                   "type": "CL",
                   "value": {
                     "primary": {
                       "n": "98303800829146496294260160277064268331997919907118759390341500977350328166231517842000775091885887150173587119204384338228587724360025337049924757520313312201967020621759572051207343682524231935224405489201055290440185974163176510090104878576328701169995084378244199652705467063808794161203659959161149007560127132880037670744886830245515761491866073613220925105572633838346259499516370003770635360926827954402726520906767008144937661365310505092955511528775052544241834421613190566785085445456937701280326372707495576721065482434721663368327906510789615533263108653864638625962089969817420000555300172786602890031221",
                       "z": "72476003402007365559845556565928748634806635139915883752613978409390905473126308272088551665751629557527257026090780882691565781493322875659930119643976149862378328821967019926482197108791091154851790913335186839467689882726608570719356393427228546437409130994394865806550695073573932358383734770013893947715744418713218523513852217777745393365867228181847718884555751338270184175861561563259256932546644962128365319668849633778829063325365704573290067047449396450683423407963221126024796067021850646141878891788651428388285824121668669515579146276588320968622193946126211400858500602056039724125800562011256035753131",
                       "s": "42314428938118651571186826115134779703483860703086624763940907279828698343295258869302936902207120747882781851312755192816862314522225460396884842099213493974195517824496394650177103662754174830470703442972131971001425153355112726092080168793819667247586882921414873593569350032645531140544160791135054500233885330752639300244506870615490491828118515865133108172271535798636685236616016643517056751913538825367987339304843930223652791588424587962670061239280811316528119994322519407542959050448909523629103578296396202312034666996580473802018483894901318690336198309682137367349639995672383323486161882045531431553620",
                       "r": {
                         "zkpsex": "55856258491718600183578747725394577058175299012235450980870451124420472847769638939899699948204084420040721298519195180280673566380743966286459415516028117435807493128391803773613043738394487412468071691445691341287159426511963376901192765305925646648979484805990584368413304006578086990644976452873172736950919175279445194223943551126543021913515294990653772406633036032048648323610201574970392698658520618413654053732744486131774566361736181233648075067983084577473701664336446529213875081372113519997764037899535174364245030758097848781320690469733758039606208126901257777005972500335973326304021028990789319396744",
                         "zkpbirth": "85158537279594543764612067545704901307148704299981131117146381651501626072046716431622294925466055909084083647564884189504115360484733128050786697623696710736714894960320633887890104711428317745706382587483367061121581674536862526553645110134940963924604687568380664520137801818425009523997788989807204669993469111525480761242055035971492463111588752799646426548900412229706060655841529691825945291885918516843242675029476568439703489225489724553234561672936978261046206520951690989612305432928729802963526578055910897993472817750618105574342583031545253811648810639317146140102769214856112071958560952275781689335970",
                         "zkpasort": "89401798810728642732230531762237007436002334565140227727256108252680001327430770577873910420276923690188395853544051661927904675924590031232736166294741963827306028420805048827461739783631673329330967429227849294054906937660202901106342099487486411462201450652392337823529796764162060156613664205251085575226636654517485697948914392269172615433301521976466801480377708600322423849655346773206376775404106401426521576636176920892891201409748848783952182138515483726978624167443614284828248273972145544143281442162414348088477470101210087253986634288871428442153997368255901639691042008086572996019123464650955374767427",
                         "zkpaddr": "35327816871925246457721034006978468971932984388376049510237420758127112959035598105950451770955506735540268163106082394818652640926129408835988647780400225208831474167172922996714094345348565773735560074388214122807415005540677918812208834883396018769027464935740876851827837213501025012150821764283900887761863359509607744595958328240633065639316625220399598050170321690347840521204331005821111041369147902690802227593991228382228241872196008977815927452648847142802478986408359114513555260611768288556084180393725205929255346560469954314749844008428970323964715139638524949099676411371948640827019656239031403940833",
                         "masterSecret": "56161441273518594236416674958351166165214447709131134259512183342535559199924445226233410565229462633126465531315201555453851525043690648655490945734180933618215162682623265380607993141742513649610961100646438797828535910504683212056945848781833563077473679901857119331342394660587471432027717640252212702875041598397252805144530744909665092967623046127023432226353053122729743510992501150766658352716500326624678473078051806151586902341089935567032624396633791375082246850091796425578916855672382877404454977532275062377857183992551234056929376807696632864940126934403300965142577553118509441802377884210429312789022"
                       },
                       "rctxt": "29512332269993461347297004284409919060308131072241645818239226076877674579759450679700905457955935349745557470984805228939597955504107392620397861039870489396452707288706421356484420055349276383356938674378397417771664070170380361139154405931036516403936062384562334149738813184413862029453007307254973649503982300442428413755779397598414947962839743927857393201171138047075946745614904219348190203091348796605450772728266115963448657795732772775239200766325854934037701620727713695286950430822767720019956190139220981022648090270613554560237275048644354051929601119033748360494100929666087560754924146656630777429115"
                     }
                   },
                   "tag": "Tag1"
                 }
                """;

        String credentialOfferDummyStr = """
                {
                   "nonce": "1068995366822249097155600",
                   "schemaId": "did:omn:NcYxiDXkpYi6ov5FcYDi1e:2:mdl:1.0",
                   "credDefId": "did:omn:NcYxiDXkpYi6ov5FcYDi1e:3:CL:did:omn:NcYxiDXkpYi6ov5FcYDi1e:2:mdl:1.0:Tag1",
                   "keyCorrectnessProof": {
                     "c": "72901940107821403108172386416242877597589945189240875901204927790716512840875",
                     "xzCap": "1411558388033389597075405334556637104048209868032249897787189266029904589968309498691685105104879697994232560581977708166152287174259189217345701003875840409628091506021238002932637724361546856491692965944843193022913295707040071721327683402423513205167459729727217524469859203349361191183950945720818562115457457711901334275926228330641984095743249911903231578050290012621790494284952986597483688471563208834983135591045210242200778746357356713118003656991303348392754358344145764394446320163913007771819903192772727861081494526129371105001032817898266483191782552411767943950308711528357764996664071192512793529328957629514628302658184543172499298330404916782353844397515865736796640554420206",
                     "xrCap": {
                       "zkpsex": "1486186029768890363363791872544170828991330718315979352704558320864232552948561150199808815897261826881165428533045516627340792965230681042255818030784166263897111230989206973120997418257132897786247066673391587020759755070723696537101756800963238226923670314064004665441045730150603050459137181687587234683939582080952806369446970441415846185046359156846108732976044253194236524723648704336062234754846186216985156812978480119784900349066768745107673540540804069883467368971287753091487384863261748139001200985250807922865151460524534945859669670020474357080675543898123465855955208263382622087519192620799651467253085410172980284194789608776849530850552172251024711291774435661251280624004215",
                       "zkpbirth": "51393859289519447309267524496920566159166399233233930986853855319233463125751158891581396989705886969721385051348787903954431155034645209083261437448386340842437267170080559589611006575302645045815421300471114895067614820593992841428514782092780261562312495355412998404203812425310922138977042611649017857689936782460480458323327986051910020331914737777501652853699783742231337758051152227126940441173063057361476779450122413377374460037362561762414902287980072045559032350197640715818949823909791799871460391649454794160834799770346081229672994988099626556387854079464016909837250798490784060805614268925480080956788841638390219615268200473271818342136791661203331610094696676117653396574817",
                       "zkpasort": "172050142319919596421923249616694997183969967128874603633857577373166609016118680196197809458977918603133773989005721688942231091836969102339842467939543285765903027042207845566125155414298043670726527960761307866478904080401457904102049908672351477047788281558734743196008820983069137510836228311530786829413261598470482368908944913282297207153145623456543115847433512767038976019713610325862405271617030609070760902723992630070827393381119190375482965063807330532748508044494089069962047993166702971456576209450828003042106505922476524970008031325269855757511511736232284731462031636161624268512918465714043383036798039936938060934307594588795740920551916314782635995816558842521266593624526",
                       "zkpaddr": "1099429362256214352584674986041322943455831836739532404915477021943197795058181394885573782306702921845626297606931175007060905513411605666952833921792715375757955133954621322609909124372423242524087887357648741598902908196407782925119314245492663480600590253317410896117359070874055466671781405755668802003954684717817693783051728361542969859625766783384945279861898885925812151316030694939276786607759656093648397240269173345592350896501864305590787077923084022377174288180855002030478924391726826894368312707674606184440153263645753409658303740286002261178923736182938581629324691831483193601881128084793868275249143801558170692119087254732056324279001093542941600008295212992764094495495981",
                       "masterSecret": "1471209351752317903450284208024258720257907973005550042953616639025797077346266962267222015913870379327732878388165128934543455051377585508131647857687850910791614195213650911723638622033851455378168605783487354643656322849535669807141070454201034576341501079937526225925190263815059501256611860209900689584012672681692543911062345738598965928764795294389155783816676959197740737420568647898132731994646221215773810889197286208355672307331295310224051953380977684697953736874623399297936803548149861250029956654820483141765828765783929736319238222296030043111512621317398245531951996044604998757907975854061413706257753442274565863646498322048036916097637708994256845857735073310836063516453631"
                     }
                   }
                 }
                """;

        WalletLogger.getInstance().enable();
        appContext = InstrumentationRegistry.getInstrumentation().getTargetContext();

        credentialSchema = GsonWrapper.getGson().fromJson(credentialSchemaDummyStr, CredentialSchema.class);
        credentiaDefinition = GsonWrapper.getGson().fromJson(credentialDefinitionDummyStr, CredentialDefinition.class);
        credentialOffer = GsonWrapper.getGson().fromJson(credentialOfferDummyStr, CredentialOffer.class);

        zkpManager = new ZKPManager<>(Constants.WALLET_HOLDER, appContext);
    }

    @Test
    public void zkpIssueAndVerifyCredential() throws Exception {
        createRequestCredentialTest();
        createCredentialTest();
        createProofAndVerify();
    }

    private void createProofAndVerify() throws Exception {
        String proofRequestDummyStr = """
                {
                  "name": "mdl",
                  "version": "1.0",
                  "nonce": "1068995366822249097155600",
                  "requestedAttributes": {
                    "attributeReferent1": {
                      "name": "zkpsex",
                      "restrictions": [
                        {
                          "credDefId": "did:omn:NcYxiDXkpYi6ov5FcYDi1e:3:CL:did:omn:NcYxiDXkpYi6ov5FcYDi1e:2:mdl:1.0:Tag1"
                        }
                      ]
                    },
                    "attributeReferent2": {
                      "name": "zkpasort",
                      "restrictions": [
                        {
                          "credDefId": "did:omn:NcYxiDXkpYi6ov5FcYDi1e:3:CL:did:omn:NcYxiDXkpYi6ov5FcYDi1e:2:mdl:1.0:Tag1"
                        }
                      ]
                    },
                    "attributeReferent3": {
                      "name": "zkpaddr",
                      "restrictions": [
                        {
                          "credDefId": "did:omn:NcYxiDXkpYi6ov5FcYDi1e:3:CL:did:omn:NcYxiDXkpYi6ov5FcYDi1e:2:mdl:1.0:Tag1"
                        }
                      ]
                    }
                  },
                  "requestedPredicates": {
                    "predicateReferent1": {
                      "name": "zkpbirth",
                      "pType": "LE",
                      "pValue": 20250103,
                      "restrictions": [
                        {
                          "credDefId": "did:omn:NcYxiDXkpYi6ov5FcYDi1e:3:CL:did:omn:NcYxiDXkpYi6ov5FcYDi1e:2:mdl:1.0:Tag1"
                        }
                      ]
                    }
                  },
                  "nonRevoked": {
                    "from": "",
                    "to": "1744596804276"
                  }
                }
                """;

        proofRequest = GsonWrapper.getGson().fromJson(proofRequestDummyStr, ProofRequest.class);

//        zkpManager.searchCredentials(proofRequest);
        String availableReferentDummyStr = """
                {
                  "selfAttrReferent": {},
                  "attrReferent": {
                    "attributeReferent3": {
                      "name": "zkpaddr",
                      "checkRevealed": true,
                      "referent": [
                        {
                          "raw": "seoul",
                          "credId": "cf0867d1-02aa-4bcf-a7bc-be7eb5eae19e",
                          "credDefId": "did:omn:NcYxiDXkpYi6ov5FcYDi1e:3:CL:did:omn:NcYxiDXkpYi6ov5FcYDi1e:2:mdl:1.0:Tag1"
                        }
                      ]
                    },
                    "attributeReferent2": {
                      "name": "zkpasort",
                      "checkRevealed": true,
                      "referent": [
                        {
                          "raw": "1111",
                          "credId": "cf0867d1-02aa-4bcf-a7bc-be7eb5eae19e",
                          "credDefId": "did:omn:NcYxiDXkpYi6ov5FcYDi1e:3:CL:did:omn:NcYxiDXkpYi6ov5FcYDi1e:2:mdl:1.0:Tag1"
                        }
                      ]
                    },
                    "attributeReferent1": {
                      "name": "zkpsex",
                      "checkRevealed": true,
                      "referent": [
                        {
                          "raw": "male",
                          "credId": "cf0867d1-02aa-4bcf-a7bc-be7eb5eae19e",
                          "credDefId": "did:omn:NcYxiDXkpYi6ov5FcYDi1e:3:CL:did:omn:NcYxiDXkpYi6ov5FcYDi1e:2:mdl:1.0:Tag1"
                        }
                      ]
                    }
                  },
                  "predicateReferent": {
                    "predicateReferent1": {
                      "name": "zkpbirth",
                      "check_revealed": false,
                      "referent": [
                        {
                          "raw": "19840402",
                          "credId": "cf0867d1-02aa-4bcf-a7bc-be7eb5eae19e",
                          "credDefId": "did:omn:NcYxiDXkpYi6ov5FcYDi1e:3:CL:did:omn:NcYxiDXkpYi6ov5FcYDi1e:2:mdl:1.0:Tag1"
                        }
                      ]
                    }
                  }
                }
                """;
        AvailableReferent availableReferent = GsonWrapper.getGson().fromJson(availableReferentDummyStr, AvailableReferent.class);

        Map<String, String> selfAttr = new HashMap<String, String>();

//        Map<String, AttrReferent> selfAttrs = availableReferent.getSelfAttrReferent();
//        for (String key : selfAttrs.keySet()) {
//            AttrReferent attrRef = selfAttrs.get(key);
//            selectedUserReferent.add(new UserReferent.Builder()
//                    .setReferentKey(key)
//                    .setReferentName(attrRef.getName())
//                    .setRevealed(true)
//                    .build());
//
//            selfAttr.put(key, "사용자가 입력하는 값!!");
//        }
//
//        // attr_referent
//        Map<String, AttrReferent> attrs = availableReferent.getAttrReferent();
//        for (String key : attrs.keySet()) {
//            AttrReferent attrRef = attrs.get(key);
//
//            selectedUserReferent.add(new UserReferent.Builder()
//                    .setReferentKey(key)
//                    .setReferentName(attrRef.getName())
//                    .setRaw(attrRef.getAttrSubReferent().get(0).getRaw())
//                    .setCredentialId(attrRef.getAttrSubReferent().get(0).getCredentialId())
//                    .setRevealed(true)
//                    .build());
//        }
//
//        // predicates_referent
//        Map<String, PredicateReferent> predicates = availableReferent.getPredicateReferent();
//        for (String key : predicates.keySet()) {
//            PredicateReferent predicateReferent = predicates.get(key);
//
//            selectedUserReferent.add(new UserReferent.Builder()
//                    .setReferentKey(key)
//                    .setReferentName(predicateReferent.getName())
//                    .setRaw(predicateReferent.getPredicateSubReferent().get(0).getRaw())
//                    .setCredentialId(predicateReferent.getPredicateSubReferent().get(0).getCredentialId())
//                    .setRevealed(false)
//                    .build());
//        }

        String selecteUserReferentDummyStr = """
            [
              {
                "credId": "cf0867d1-02aa-4bcf-a7bc-be7eb5eae19e",
                "raw": "seoul",
                "referentKey": "attributeReferent3",
                "referentName": "zkpaddr",
                "isRevealed": true
              },
              {
                "credId": "cf0867d1-02aa-4bcf-a7bc-be7eb5eae19e",
                "raw": "1111",
                "referentKey": "attributeReferent2",
                "referentName": "zkpasort",
                "isRevealed": true
              },
              {
                "credId": "cf0867d1-02aa-4bcf-a7bc-be7eb5eae19e",
                "raw": "male",
                "referentKey": "attributeReferent1",
                "referentName": "zkpsex",
                "isRevealed": true
              },
              {
                "credId": "cf0867d1-02aa-4bcf-a7bc-be7eb5eae19e",
                "raw": "19840402",
                "referentKey": "predicateReferent1",
                "referentName": "zkpbirth",
                "isRevealed": false
              }
            ]
        """;

        List<UserReferent> selectedUserReferent = GsonWrapper.getGson().fromJson(selecteUserReferentDummyStr, List.class);
        WalletLogger.getInstance().d("selectedUserReferent: "+GsonWrapper.getGsonPrettyPrinting().toJson(selectedUserReferent));

//        ReferentInfo referentInfo = zkpManager.createReferent(selectedUserReferent);

        String proofDummyStr = """
                {"proofs":[{"primaryProof":{"eqProof":{"revealedAttrs":{"zkpaddr":"21224889883149768092131882119095173851218656983871668929472739274089421294476","zkpasort":"1111","zkpsex":"5944657099558967239210949258394887428692050081607692519917050011144233115103"},"aPrime":"17590279481759165708501031461698599543307038221947078704445464788325236218855915823969077793475555630792341464779804182288412128001006317359943092925643146411858497273343778312845471771592403403119136335631499480664197617587776239769544736249332371915553977473256747677176945040904060990822129800505637920554440126379022991479215044417278366075877053765308911395141743090809892861253254164817881711920245872958875401188224349715661267738461351592411809084310819156521700821579907203536251560954011772969499342623385592540202005995140881138302300384599854109530644073547541070981413883395169519638262208196027765460718","e":"17199913096741771605055692910197304239421258794406169628400074391099467041367222697531789029263202731295580449031976571133340784072016334","v":"920950136571772026448269819295503189561041845985880524458515364829200008854814899225947229422847551815127657688178143082919141698638406491537325619583553526889834853040782875552870231639719193195261619251488388460702773815539970162394394859763380623085160371128975484040773377629974584574833955939835198724146960008447435095256229776521564894418692874055249665164861602684891939144096070934789828792331153095950107377946939839838982532654959658006620956109188127296002921221500730014332044812935141688556670927726120882787668463230332337090838038433613140875127573065243878630056975311854379783668810642585293098356550161253323393994823103686216024608704902898457119474951381153124174896029818476823227833922396435319673593183374076434347427943957183944223497623226593657516532863847824177261621891024224485538026079188040716179226834732590193023519556585781060279104014683900705239036972498957935102748204434575048885250","m":{"masterSecret":"14877461605133703928256559970020843450564092552400631113881783850766378780464324817351646395950786584766770967432433451648224104938646580662904003935736367227510740609735047959923","zkpbirth":"2809390552129680953143579754539019784871998784142762490153813385771880037718495899291893302563848303445610964832910502646120171867196450447414276568359209378144755806969200075227"},"m2":"3608457560536364646281975962520014319512035124938173760266041148582560800020633737087644216055002035803928372882417887003989496742685631566836160052518033"},"neProofs":[{"u":{"0":"12116113879207725713345919659800716727267959198218110004849924913486813468255906825515354749461435428194506863522206123742486076851766063452091213316237580592721661064124715654661","1":"4934186777443822461462856872269920460151828108054557431884528171128376198783460682816177944163934302673354354254935719498929903322382148808548924818991143417146564343192696094975","2":"4194849333697929079474447717304568099636835733490675288885341250885718896474063383785721492145964013065042688448469033769176972759173600098011752490812448104381479380145358828148","3":"12011124188136362845028712595358223046356549311283780421516275534093883665626106284116008523237042744412128780166982070505046721973298158899989568341320335106758926079151177767639"},"r":{"0":"1016643226642107608372304570061465383475949027271583799406385536792684663253900843388512698685657088827326973208474016251115971068839935006588836889832498117242307738071244052017461926597908153364576286230038465309089323831089072689715734114531532345174908323614620260847957674526655586537148227864104704979098586582876220811857356914686236401839951950552058944225272421924260302418435381853537971907823327810693870538293132063207675723639056961364497942521213055841809156528323685786029922339819409732758719613007570578920073756189070193428860370830353635312621027059611395948645970931426627637685284510528509580391429845483454589816123503010757784966426111416825723644847265200304076293247432592501847755683834003581","1":"82481766273933393358234215788981678378117011359466822549846260076824833320528738465943320543193384109306746277620802032184557478596621034012070696105469955855319915891244333694015420619367079715000353484903096610511455450783363114623762813723192333495161067509929402693797713652451693194368727476597657940059655524504927532395641661780730408686201405742268210943190531531871595412046147793175159535349203435922928711759363810425403185236148690348795818330645188036531429940359001299845032608877922481345549530768295218148796865081887645222589872876096384050341724965004562101992938963746114559575811479068424165676363147734000976046710780090680625060943372503637641347445718722428996318786026466569034036885027835817","2":"867742022413233448513681381565338350634900333514511018381927238368371680716661836793500409287008476371143308050519944444908127871858709564721862316886794389903518490685766442123232431640277984564095365424054235998030366799854109499418077329442917456077696917329606938651026996653765499405684779507544402324592870861668491387226566234336462883893693685051841993155471029437536834729136798904992819978062198452870342200594110483189686340868169434915044308370996296762331500378512522887463273265675509374420398210864534558975923790832675918214864342890051187734026820762659836589025819005190583726329242594430985593450609064585707848197026939246956593480498653820646444590570914501471504498419231237706465697509994204225","3":"810514265893994090997099206893037109484000781942475774300498828866536406092345017983154194783111268289047202872002674108751217806305994824852826747184635042428246209416080634431405179339336749410742321620131427036293147542227538432954056381428883432964828066752510237423262212584517314420381471651342502150496859727747989961539522686720423960435826780602998575539151849914486485908070802804293426889410076693942025971148319740037777887693221952944239060072901596368043392338044454836997090091699662545661856774472287147510644098055832463426997302555131839278884675881116065244214248784028691449773180967443980256483457562473075453330146707493314688343919896354864267237600996936914140947712427619930343511098408173436","DELTA":"1347047375707773130073066269297665113713535819746368386617395123661875957962725919364644134944921860865263390048523203726060294643346292900347454198454865474514461417225251334793853001644241013284312013035961595115039394678539974725795241586550898946115662143402824033714020375602154077952895211409591566981434159729965608523358921803612473059179715930980798558626844720747988596956964236750315053948595210560594546022088158936983354528761085578108246386080843769656215011451700834789827363624770191452367464244672836987867180460112933780928116290923407707362298705819629209542285032173332381757779056062198454347053507104091433063474338067643443114762908657113540719652181265688158863185450583855385561975784092544303"},"t":{"0":"46715313098420110112187761376092251237852959632233006636904558735076559550075089260812346768632352026515993563915387885773756903083027215307665231110783676384466301312123462211864448690644021584383899308215118507361077306171373786066810636035356651270971579620237532303408054962596673979326916418158912102863904419827514934000780063626085470137688709488174737596175145581574486292456266285827965085489262659707912781787592305534022381293231909419569556668636717899003928182758968199728319082756686812238381053136348725161868673309261084360154919450897092497385190766390573875041053441649552003028195913121852935537517","1":"92756303829145175041159593501067899275270848716449038545583814706491449987533843588951792476679796758459302830309632042843635296345959187432943182866653529238500908878756292093680396896919236584871204737891106738038217421744928594638853995166893155646728286288842262789164407413515762993331655367958547782519529156137981705248607566173687756846325738524881600465960405935971572934124712208071103404785334458111711268991671038265915347992558072501309518024022772345289010844571883888048575125565206268250407425294815617768385494905762492356635150606201519950720923240134009845565949636209352022285112920936064357722571","2":"27568779402182464990725786874342298414124132742944297320773272964587726905033864734664602965240818908330442205152899163306436305814604757651164366379491231714154424625085778357462957955452019591088159128566889846948806392791616243056964409858760297391605724685872103922305112210324446097494003734635459723242952133954119619403992427385684774985063321041083670542386247991001103444986890107978783050337538046489089214644712264891519702184505729229114798441211734896031185155821857122855484021675772414306032376455743923127555113637464287133743800075281257167608018810599185012702527449463726587945114442223331713794412","3":"71319290763555941374298347880377540751124804428224342835264710802557314671903372493894743501128653613708246050000725097878109370665661551599354537454574925979544368225267640153894967428373551320798358007284384582416107154694985931852317518945723091440930601373700164136874146701060430325471265305960556630638611907427401946415235829599807238878232823793306883387397186406037580542243580546125041586456302677476320237922190344830911677185481058010162261008122911256657085188177456899603294813127402636507492280111707655603610840157802633042480416492866897880051458766211433213427417618112946044368649736483653382448702","DELTA":"92062156609760978610821438008149194423573641936886584732864908648580802952198873946386674296876580213189490102788944345173318761444388568765318755278260152001165310040346208480428976189710688834347321842411278347754596638528738460533841024558494757824218703329107486087831393387495159593025975718653797326783795970886584484372550243068178671118367997064227129460907423941112146713604991089998868008555982125225148669649492693794230451436039794766732038248224008131481938148651831839042863212824173933632813731637849644011642398475355756947802231259876517845700720451163971231956256067495358804954166650945973518219361"},"mj":"2809390552129680953143579754539019784871998784142762490153813385771880037718495899291893302563848303445610964832910502646120171867196450447414276568359209378144755806969200075227","alpha":"80447599974479756004974201743333898844097488026402844577024807293464325904799588958520757264998043759338925835245927748695860076652830933853988614897912935126521027867570534059568876054376928484440505582793598108558199446974974730625562226904947084460298282628224366377653145088503051990394483457335094225767005462779844288732390456899604547911001448172617805935335098250761366641657017648980526393523003274759321508507399520821754260511859500468129537403160242490753829631639119903419907892891094283732778118133730943229652192680474796905153012322459018543167729648344227173709255726433211743022775028831380915233574656968046660167591596237715052587165545763892277233700727609174147334073813872065806875212089271148430201382220200608110589526558422160076306278152002295875207111949268364987703336121798147217205989594818708542094979786862","predicate":{"pType":"LE","pValue":20250103,"attrName":"zkpbirth"}}]}}],"aggregatedProof":{"cHash":"40785259179740278452689382853234161570320003410063398547717879835776849908760","cList":[[-117,87,-125,-63,81,-122,70,-58,-112,-113,-70,60,-68,-116,-1,111,82,-6,-18,67,-45,69,-30,37,113,-116,47,-56,-86,-17,97,56,-46,22,117,92,-78,-103,-28,-19,124,-99,16,-113,90,-8,-48,121,86,30,114,-90,5,35,-54,-19,64,36,102,-107,31,112,86,-112,-36,98,93,-29,71,46,-92,-71,3,26,34,71,-92,-6,-44,88,5,20,16,8,-120,44,17,-72,90,-107,-71,25,19,56,-76,44,14,83,-110,124,-97,-60,72,-65,-96,-19,-88,-123,-49,-95,-40,102,-45,-32,-114,-90,13,-35,-3,-118,42,-118,-88,96,5,61,-52,50,38,-27,-36,23,-111,32,-118,30,91,21,-122,67,10,-27,-82,89,-59,-49,-104,-28,-104,7,37,-85,-77,-40,118,-51,-95,-78,-89,-13,8,111,-116,-47,16,79,93,-123,59,-55,31,36,70,-105,78,-56,100,-118,-104,-91,45,-96,74,22,98,110,80,24,47,104,-32,-23,80,43,-61,88,-107,-125,-63,-39,69,-11,-74,78,-108,73,-44,-4,-115,-101,73,-108,-86,-126,73,-53,-36,-99,6,99,105,-52,-45,-98,-65,-65,-13,52,-101,-51,-97,68,-7,-45,116,85,81,13,10,98,-59,98,-98,105,36,20,-52,-81,-41,-37,127,98,-104,-77,-114,-18],[1,114,14,122,-44,-26,-104,49,-76,64,116,5,-12,9,36,104,-88,76,-105,97,-85,69,37,106,82,-28,-76,-24,-91,108,117,-47,-23,48,97,-125,-56,88,-118,61,78,-6,98,-10,-33,96,-114,-63,81,-64,24,107,-56,30,-117,-117,-25,-9,-34,-7,-47,85,82,-20,-59,-83,-11,47,102,-27,105,88,28,-32,40,77,15,110,-28,-14,-23,14,105,-19,-101,98,73,-60,79,-82,84,126,13,58,27,-8,8,28,77,83,18,43,10,50,112,121,-73,40,-28,71,-72,84,-119,-6,-57,108,33,-109,14,-7,50,-124,-119,-35,23,-31,-91,21,-58,-32,-118,66,86,90,-88,-17,27,113,38,-52,34,-42,-35,-39,-46,-13,22,82,-16,-1,-48,-3,78,52,-26,-115,-64,-75,-106,70,-110,-101,-9,63,-17,-69,72,-108,24,43,119,-32,123,-36,-39,61,49,-22,-81,-67,119,7,-61,-115,-93,48,-37,-116,15,-71,-5,-37,-99,70,-118,36,118,-71,76,116,-57,-110,81,-119,66,76,110,82,-68,32,81,-81,29,-81,-33,107,77,113,92,20,16,125,45,-33,-5,59,-1,-123,103,78,72,-97,-91,86,28,-95,34,50,95,110,-35,50,-12,-31,54,57,-104,-110,-121,124,67,85,-4,-2,-118,-125,109],[2,-34,-59,126,127,38,-53,63,-104,99,-60,51,103,-75,-121,-1,84,-100,121,104,95,76,7,-34,-23,93,116,42,0,82,105,-123,38,1,-6,121,50,30,-49,-110,-31,-101,2,-111,-1,-123,-24,47,64,112,6,29,-78,-18,71,-35,-4,-31,-104,96,-7,86,-50,36,19,-116,-108,-47,95,-91,-117,-69,-10,40,-2,15,-98,14,127,-65,116,90,-85,60,-43,-47,102,-110,60,-97,-1,-62,13,18,46,-75,-86,71,-108,-34,78,49,47,-78,27,-102,-56,-65,12,2,72,-69,20,58,70,-11,48,-20,22,70,-18,-106,-30,-124,74,29,-8,-16,118,-123,-103,47,35,-105,-78,-127,13,112,-107,12,-104,-44,126,-71,-65,72,-67,-34,-14,4,65,-93,74,-79,-32,-77,-5,-58,26,-84,-51,-22,-20,93,69,0,116,-20,-88,80,48,96,122,16,-116,-87,-27,120,62,78,113,29,-79,-100,56,12,40,-28,-83,-32,29,109,111,-15,124,62,58,-125,102,-6,-6,102,-68,99,-97,33,118,-116,23,7,54,20,-94,-55,-63,7,94,-17,-14,-22,-103,-64,121,100,-68,-43,72,72,-108,122,79,-73,62,77,75,-30,102,-119,9,-87,-73,38,45,41,-79,103,80,-80,40,-121,-104,82,107,-54,-61,105,-53],[-38,99,5,75,-102,79,-40,17,22,105,-22,-124,-19,5,8,-75,-30,-25,-3,47,53,-68,-45,-65,-23,44,-50,90,-91,47,-52,121,-107,10,12,-103,-60,-12,93,-15,41,-46,-102,-58,19,21,112,-80,77,10,-93,-118,-128,-50,47,-79,67,52,-38,111,95,89,-80,95,70,46,56,6,-50,44,-73,-91,-45,-110,-110,-121,-29,68,-24,-91,106,26,113,-47,8,29,-104,127,116,-17,-98,101,-83,-50,32,56,0,-46,-98,104,-19,-54,116,-8,96,87,46,-103,-37,13,-10,95,-19,3,-109,-73,108,53,-65,-57,-59,-76,-70,105,-18,-103,53,8,41,-87,98,75,81,-8,-7,57,11,-118,10,-104,-31,-57,44,27,19,-11,66,-86,99,16,4,-120,-6,87,80,-23,-88,116,-78,39,-118,106,111,-40,123,61,-60,117,-20,45,61,-77,-63,-94,75,89,48,33,-32,-75,-55,96,51,115,68,20,-120,-55,96,-116,44,18,20,-50,-3,123,-1,-27,120,-74,51,-79,90,-8,-63,33,111,66,-2,-33,40,-100,124,36,-124,-9,107,24,-18,-87,32,13,-112,61,115,111,-100,-8,-114,-16,61,51,119,63,-99,-123,41,56,-79,57,-38,24,-40,69,50,26,-10,99,43,56,104,-16,40,88,-63,108],[2,52,-11,37,-59,-33,-43,105,-103,4,55,18,20,-59,94,-79,-100,-70,82,115,43,115,-66,-82,-89,-9,-120,75,-56,123,22,-115,-56,-78,112,-5,95,23,-121,-41,-88,24,-96,93,103,-118,-18,32,-81,-23,105,-125,70,95,75,-14,120,99,119,30,57,-98,71,32,74,-99,38,125,68,-49,-50,-114,-67,-93,-55,-96,-61,3,-70,104,-9,13,-56,125,19,47,-115,-68,60,22,74,-24,-19,-48,-39,97,58,-79,-75,-40,-82,-125,78,-9,-97,30,38,-128,97,97,82,-93,48,-19,15,16,-80,-89,-51,-83,92,-5,-95,75,-76,-14,-63,67,-68,-122,100,76,101,20,-124,31,-47,118,-55,-91,-25,58,-101,-26,2,89,11,-38,-99,-68,-127,44,-113,-19,85,105,106,-44,-122,48,-104,43,49,-92,-28,60,-15,-39,1,117,87,-51,-70,-94,105,-40,47,-88,-40,-118,66,103,-7,-22,72,-43,98,-47,-51,-71,127,-99,52,29,-113,-106,-87,122,-69,-33,-48,-48,110,-104,-21,-32,-69,51,48,114,77,103,-96,-78,80,-62,96,-43,77,37,-38,-14,-33,124,90,-107,85,-67,-16,-1,-125,-49,-113,-116,23,12,32,27,61,15,116,-14,19,-69,-66,44,49,34,107,98,24,40,-9,109,66,38,62],[2,-39,69,-45,90,-27,-2,-29,118,69,-58,29,21,106,65,102,-23,-28,-111,104,40,89,111,4,-19,-123,102,92,-78,80,-68,66,-19,-14,-93,17,-122,-84,-28,101,-35,60,83,-110,-63,14,110,-38,118,-105,-126,-95,-60,-55,-73,107,99,96,-32,-46,-105,-29,9,-33,-44,81,-56,109,42,-84,-42,-52,-66,-35,-119,-54,-88,-25,-126,79,115,82,29,-37,83,-61,-33,23,-79,30,-71,-24,31,120,-65,-77,18,-17,17,55,59,33,78,60,-64,-120,44,50,-49,-12,33,-68,-49,-43,-108,42,-61,51,42,124,61,82,-114,64,-101,64,114,52,-89,-108,-27,71,92,-35,-99,106,31,-71,52,44,107,40,119,122,-58,-107,56,32,-64,-68,36,45,-120,-90,-113,-56,-92,56,35,13,3,-89,44,72,80,-37,-37,-95,100,93,99,65,-80,33,88,-83,39,25,40,-60,-98,-102,-50,24,30,65,-78,79,-108,111,79,-64,6,-32,33,-59,32,-50,-43,-96,52,-107,38,82,34,-123,43,94,61,23,-39,127,-86,113,50,13,-111,-64,12,84,45,-82,-57,32,28,-11,66,50,-21,-2,-56,68,-6,10,-85,124,46,-86,52,-62,91,-3,-29,-30,94,120,62,80,-19,-98,45,40,-47,-2,-98,56,97]]},"requestedProof":{"selfAttestedAttrs":{},"predicates":{"predicateReferent1":{"subProofIndex":"0"}},"revealedAttrs":{"attributeReferent3":{"subProofIndex":"0","row":"seoul","encoded":"21224889883149768092131882119095173851218656983871668929472739274089421294476"},"attributeReferent2":{"subProofIndex":"0","row":"1111","encoded":"1111"},"attributeReferent1":{"subProofIndex":"0","row":"male","encoded":"5944657099558967239210949258394887428692050081607692519917050011144233115103"}},"unrevealedAttrs":{}},"identifiers":[{"credDefId":"did:omn:NcYxiDXkpYi6ov5FcYDi1e:3:CL:did:omn:NcYxiDXkpYi6ov5FcYDi1e:2:mdl:1.0:Tag1","schemaId":"did:omn:NcYxiDXkpYi6ov5FcYDi1e:2:mdl:1.0"}]}
                """;

//        List<ProofParam> proofParams = new LinkedList<ProofParam>();
//
//        for (String key: referentInfo.getReferents().keySet()) {
//            WalletLogger.getInstance().d("referentMap key: "+key);    // credential Id
//            Referent referent = referentInfo.getReferents().get(key);
//            proofParams.add(new ProofParam.Builder()
//                    // id로 조회
//                    .setSchema(credentialSchema)
//                    // id로 조회
//                    .setCredDef(credentiaDefinition)
//                    .setReferentInfo(new ReferentInfo(key, referent))
//                    .build());
//        }
//
//        WalletLogger.getInstance().d("zkp verify 사용자가 입력한 proofParams: "+ GsonWrapper.getGson().toJson(proofParams));
//        Proof proof = zkpManager.createProof(proofRequest, proofParams, selfAttr);
        proof = GsonWrapper.getGson().fromJson(proofDummyStr, Proof.class);
        WalletLogger.getInstance().d("proof: "+ GsonWrapper.getGson().toJson(proof));
    }

    private void createRequestCredentialTest() throws Exception {

        String credentialRequestDummyStr = """
                {
                  "credentialRequest": {
                    "proverDID": "proverDID",
                    "credDefId": "did:omn:NcYxiDXkpYi6ov5FcYDi1e:3:CL:did:omn:NcYxiDXkpYi6ov5FcYDi1e:2:mdl:1.0:Tag1",
                    "nonce": "1068995366822249097155600",
                    "blindedMs": {
                      "u": "21747772870684733519973036510398343558270404752303119051113657881807964491385461756868194676739124844687950351497619628445012057952599263294471931644221338062966776046717054377403833024505711048218199155589304244722427112970153935240532151064378964867101313272033700749802484073900416372078804866644867896334469684967037012097403631804716567701813955671856424850921743899574804524662587038941553756055732905108802016339952990527353250120078308258596927369428481681594273145031635029710229700708251576368490741893421151242939216760156668385941232909262844829343508046443301476742719368550074583474636410580242689821285",
                      "hiddenAttributes": [
                        "masterSecret"
                      ],
                      "committedAttrs": {}
                    },
                    "blindedMsCorrectnessProof": {
                      "c": "27715615520478217685621516251939647289800051223051190263714523986968318753071",
                      "vDashCap": "1072895557306776375911654257392221889544721562140093945977759226969361724611359743261387983756187046600551593782018659881898538313339755090089049291533089088849589728956083536852412825376545287511143879606479075188781548904352161129997255532320826409273043652171076855228206648283154364295093210915000378988977691240966158004256084000305891913142488710006189810306171390784553057255769188512597455454175705383133806167621290877803030569422936992011641987513693209257754779559552652120016701886040685638865716816811524407104427358149216453518532023083666954622774730863730739084232060180696636584156382631153439748504396034551342206015318417819761197796168903988074802262691956711923412622291401465978549772094634200439",
                      "mCaps": {
                        "masterSecret": "18831277923866338198529883301090958293206339559995348654657921300143503931167506612980820303591073492883855370599811965122109720365880071615071981597333890638918402029626948253310"
                      },
                      "rCaps": {}
                    }
                  },
                  "credentialRequestMeta": {
                    "masterSecretBlindingData": {
                      "vPrime": "38710868842658276052074493247988729580136084473626984736696500828995360468192036247276746176354775180866358702122742155106746495847068899668869402339020320555107641514062430288891489875428656474414171344440182402631154092985074233791147154582146651564549985595406136113669611299379429606098526818124788971052482480063080535092544759022827068220730065680793011252959682264716106595704005608679619226213939189324919478014872840813285274981654256668749100642957882254068625082228385089859553914774421926944666993792935294999843164682481716014052047072155264295385522790500763461481775297378928185074888453921640612234447273322878887992873633820"
                    },
                    "nonce": "1068995366822249097155600",
                    "masterSecretName": "242d62d8-a2f3-44d7-a2e6-7286512617c9"
                  }
              }
            """;
//        requestCredentialBuilder = zkpManager.createCredentialRequest("holderDID",
//                                                    credentiaDefinition.getValue().getPrimary(),
//                                                    credentialOffer);
        requestCredentialBuilder = GsonWrapper.getGson().fromJson(credentialRequestDummyStr, CredentialRequestContainer.class);
        WalletLogger.getInstance().d("requestCredentialBuilder"+GsonWrapper.getGson().toJson(requestCredentialBuilder));
    }


    private void createCredentialTest() throws Exception {

        String credentialDummyStr = """
                {
                    "credentialId": "cf0867d1-02aa-4bcf-a7bc-be7eb5eae19e",
                    "schemaId": "did:omn:NcYxiDXkpYi6ov5FcYDi1e:2:mdl:1.0",
                    "credDefId": "did:omn:NcYxiDXkpYi6ov5FcYDi1e:3:CL:did:omn:NcYxiDXkpYi6ov5FcYDi1e:2:mdl:1.0:Tag1",
                    "values": {
                      "zkpsex": {
                        "encoded": "5944657099558967239210949258394887428692050081607692519917050011144233115103",
                        "raw": "male"
                      },
                      "zkpbirth": {
                        "encoded": "19840402",
                        "raw": "19840402"
                      },
                      "zkpasort": {
                        "encoded": "1111",
                        "raw": "1111"
                      },
                      "zkpaddr": {
                        "encoded": "21224889883149768092131882119095173851218656983871668929472739274089421294476",
                        "raw": "seoul"
                      }
                    },
                    "signature": {
                      "pCredential": {
                        "a": "44300816749332857648095757871104757376424681627442877355980771182101355535345454466414237735396372049767644666773262144052646788662477662793334731835337476272236724742625403728251147902994307740405509793196002730533740501797495051988637882368817491709216284393695031361355750120646163903840459590741565983814889686282781954973809223024792414046358745580986603652102557434916434331124709609352933357449783461098616725988054881747486409384696710417117368818943689662191970848781005677764263163446232986020414769875632552929266240765499045794050757160922960575745503429512200272523545196779903664386432913304719228507662",
                        "e": "259344723055062059907025491480697571938277889515152306249728583105665800713306759149981690559193987143012367913206299323899696942213235956742929827241858688935706526849944937260943",
                        "v": "9016172996397004058351646071147966794308301549404191781047087607587827779645557791020516757717356742091037904051797273860592163645007753125800661800316094301996883736451448116487325124669689036657209028015828308857013526977790911837468553853970936598680741621115577778228701827709765559596292010843744809401924811703408931850772104232272943875076350589317468171967697879689925471455228052521308062807684357899754587754824185696679552092030627019546474336480432685036710309083176418112609949422776263043936542792340767829664238997543366381018626712445820229838900743746875347495442361483903508484675052724999719863129818842925942526231576603261315758578848631630668167536627929158573911320824914222057869824024188703238207463564694463005362773242838032767616062568156786986744547689000333300341399499277843089080086875472",
                        "q": "16759897001037129464762380788066186570834221510566190208582481609729948234587995417948453894780892182977008138604827246167777991172812617341944516719118764397883622492807173066695994721694991383040798450076230272677924169313539404012347693750465869396917761784651626712568363519343820574450267775896339433767868079774257995308106921864356047152713097530357258485954419201964918218909914720402947327535163403860453096083803850345370301706781966412577667776573518432478252408523402346359191350625868609750817850095380376309037262960235834651154604068064593964016325511512151653176804855022037546118769118523685814564434",
                        "m2": "88474552647414202211113104363819791025935012128158586480381797774592934936761"
                      }
                    },
                    "signatureCorrectnessProof": {
                      "se": "8386678115761068947476437993493317669164005627745546129378619828356497380715823290366657029154219292365500514739649626793296177248537177848185049526733278846778041007658748387360660732142722959592552686476847529935486652281603115905314931818276698255773816541534314037303777646555967299723626366087418909723034959532649055310099324766538238887344969346533923047281001706191956937898344906830383174835899669380889602395905133633140888802376687532876913017547922568460910138446566925612818956082630212606606482007397760946383241054380552408048133260356201963046609894151359627753161147868072259793119214159134269140677",
                      "c": "37075329827581829748960271359553685394721250854606600462705946986928652828487"
                    }
                  }
            """;
        credential = GsonWrapper.getGson().fromJson(credentialDummyStr, Credential.class);
    }
}
